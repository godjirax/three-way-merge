import { Resolved } from './outcomes';
import MergeResult from './merge-result';
export default class Collater {
    static collateMerge(mergeResult, joinFunction, conflictHandler) {
        if (!mergeResult.length) {
            return new MergeResult([new Resolved([])], joinFunction);
        }
        else {
            mergeResult = Collater.combineNonConflicts(mergeResult);
            if (mergeResult.length === 1 && mergeResult[0].isResolved()) {
                return new MergeResult(mergeResult, joinFunction);
            }
            else {
                return new MergeResult(mergeResult, joinFunction, {
                    conflict: true, conflictHandler: conflictHandler
                });
            }
        }
    }
    static combineNonConflicts(results) {
        let rs = [];
        results.forEach((r) => {
            if (rs.length && rs[rs.length - 1].isResolved() && r.isResolved()) {
                const last = rs[rs.length - 1];
                last.combine(r);
            }
            else {
                rs.push(r);
            }
        });
        return rs;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sbGF0ZXIuanMiLCJzb3VyY2VSb290IjoiL1VzZXJzL2tldmluL3RyYXZhaWwvZGV2eC90aHJlZS13YXktbWVyZ2UvIiwic291cmNlcyI6WyJjb2xsYXRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsUUFBUSxFQUFXLE1BQU0sWUFBWSxDQUFDO0FBQy9DLE9BQU8sV0FBVyxNQUFNLGdCQUFnQixDQUFDO0FBS3pDLE1BQU0sQ0FBQyxPQUFPO0lBQ1osTUFBTSxDQUFDLFlBQVksQ0FBQyxXQUFzQixFQUN0QixZQUEwQixFQUMxQixlQUFpQztRQUNuRCxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sRUFBRTtZQUN2QixPQUFPLElBQUksV0FBVyxDQUFDLENBQUMsSUFBSSxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxZQUFZLENBQUMsQ0FBQztTQUMxRDthQUFNO1lBQ0wsV0FBVyxHQUFHLFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUN4RCxJQUFJLFdBQVcsQ0FBQyxNQUFNLEtBQUssQ0FBQyxJQUFJLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFVLEVBQUUsRUFBRTtnQkFDM0QsT0FBTyxJQUFJLFdBQVcsQ0FBQyxXQUFXLEVBQUUsWUFBWSxDQUFDLENBQUM7YUFDbkQ7aUJBQU07Z0JBQ0wsT0FBTyxJQUFJLFdBQVcsQ0FBQyxXQUFXLEVBQUUsWUFBWSxFQUFFO29CQUNoRCxRQUFRLEVBQUUsSUFBSSxFQUFFLGVBQWUsRUFBRSxlQUFlO2lCQUNqRCxDQUFDLENBQUM7YUFDSjtTQUNGO0lBQ0gsQ0FBQztJQUVELE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxPQUFrQjtRQUMzQyxJQUFJLEVBQUUsR0FBYyxFQUFFLENBQUM7UUFFdkIsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFO1lBQ3BCLElBQUksRUFBRSxDQUFDLE1BQU0sSUFBSSxFQUFFLENBQUMsRUFBRSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLENBQUMsVUFBVSxFQUFFLEVBQUU7Z0JBQ2pFLE1BQU0sSUFBSSxHQUFhLEVBQUUsQ0FBQyxFQUFFLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUN6QyxJQUFJLENBQUMsT0FBTyxDQUFXLENBQUMsQ0FBQyxDQUFDO2FBQzNCO2lCQUFNO2dCQUNMLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7YUFDWjtRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsT0FBTyxFQUFFLENBQUM7SUFDWixDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSZXNvbHZlZCwgT3V0Y29tZSB9IGZyb20gJy4vb3V0Y29tZXMnO1xuaW1wb3J0IE1lcmdlUmVzdWx0IGZyb20gJy4vbWVyZ2UtcmVzdWx0JztcblxuZXhwb3J0IHR5cGUgSm9pbkZ1bmN0aW9uID0gKGE6IHN0cmluZ1tdKSA9PiBzdHJpbmc7XG5leHBvcnQgdHlwZSBDb25mbGljdEZ1bmN0aW9uID0gKGE6IE91dGNvbWVbXSkgPT4gYW55O1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDb2xsYXRlciB7XG4gIHN0YXRpYyBjb2xsYXRlTWVyZ2UobWVyZ2VSZXN1bHQ6IE91dGNvbWVbXSxcbiAgICAgICAgICAgICAgICAgICAgICBqb2luRnVuY3Rpb246IEpvaW5GdW5jdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICBjb25mbGljdEhhbmRsZXI6IENvbmZsaWN0RnVuY3Rpb24pIHtcbiAgICBpZiAoIW1lcmdlUmVzdWx0Lmxlbmd0aCkge1xuICAgICAgcmV0dXJuIG5ldyBNZXJnZVJlc3VsdChbbmV3IFJlc29sdmVkKFtdKV0sIGpvaW5GdW5jdGlvbik7XG4gICAgfSBlbHNlIHtcbiAgICAgIG1lcmdlUmVzdWx0ID0gQ29sbGF0ZXIuY29tYmluZU5vbkNvbmZsaWN0cyhtZXJnZVJlc3VsdCk7XG4gICAgICBpZiAobWVyZ2VSZXN1bHQubGVuZ3RoID09PSAxICYmIG1lcmdlUmVzdWx0WzBdLmlzUmVzb2x2ZWQoKSkge1xuICAgICAgICByZXR1cm4gbmV3IE1lcmdlUmVzdWx0KG1lcmdlUmVzdWx0LCBqb2luRnVuY3Rpb24pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIG5ldyBNZXJnZVJlc3VsdChtZXJnZVJlc3VsdCwgam9pbkZ1bmN0aW9uLCB7XG4gICAgICAgICAgY29uZmxpY3Q6IHRydWUsIGNvbmZsaWN0SGFuZGxlcjogY29uZmxpY3RIYW5kbGVyXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHN0YXRpYyBjb21iaW5lTm9uQ29uZmxpY3RzKHJlc3VsdHM6IE91dGNvbWVbXSkge1xuICAgIGxldCBycyA9IDxPdXRjb21lW10+W107XG5cbiAgICByZXN1bHRzLmZvckVhY2goKHIpID0+IHtcbiAgICAgIGlmIChycy5sZW5ndGggJiYgcnNbcnMubGVuZ3RoIC0gMV0uaXNSZXNvbHZlZCgpICYmIHIuaXNSZXNvbHZlZCgpKSB7XG4gICAgICAgIGNvbnN0IGxhc3QgPSA8UmVzb2x2ZWQ+cnNbcnMubGVuZ3RoIC0gMV07XG4gICAgICAgIGxhc3QuY29tYmluZSg8UmVzb2x2ZWQ+cik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBycy5wdXNoKHIpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHJzO1xuICB9XG59XG4iXX0=